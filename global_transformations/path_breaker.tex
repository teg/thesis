\TODO{Add labels to edges}

%--------------------------------
\newcommand{\frpb}{{\mathsf{pb}}}
\begin{definition}\label{definition:PathBreaker}
We define the reduction $\to_\frpb$ (where $\frpb$ stands for \emph{path breaker}) as follows, for any atomic flows $\phi$ and $\psi$:
\[
\atomicflow
{
(-8, 7)*{\afvjdm{6}{\boldsymbol\epsilon}{}};
( 0, 8)*{\afaid{}{}{}{}{}{}};
( 8, 7)*{\afvjdm{6}{}{\boldsymbol{\epsilon'}}};
(-5, 0)*{\affr{8}{8}};
(-4, 2)*{\aflabelright\phi};
%---
( 5, 0)*{\affr{8}{8}};
( 6, 2)*{\aflabelright{\psi}};
( 8,-7)*{\afvjum{6}{}{\boldsymbol{\iota'}}};
( 0,-8)*{\afaiu{}{}{}{}{}{}};
(-8,-7)*{\afvjum{6}{\boldsymbol\iota}{}};
}
\quad\to_\frpb\quad
\atomicflow
{
%%%%% RED %%%%%
(0,-20)="D";
(0,-10)="Dhalf";
%% contractions
"D"+"D"="A";
%left
"A"+(-14,-15.5)-"D"*{\afvjmcol{23}{Red}};
"A"+(-11,-17)*{\afvjumcol{4}{\boldsymbol\iota}{}{Red}};
%right
"A"+(11,-11.5)-"Dhalf"*{\afvjmcol{11}{Red}};
"A"+(14,-15.5)-"D"*{\afvjmcol{23}{Red}};
"A"+(11,-17)*{\afvjumcol{4}{}{\boldsymbol{\iota'}}{Red}};
% top boxes
(0,0)="A";
"A"+(-11,-14)*{\afcjrmcol{6}{20}{Red}};
"A"+(11,-14)*{\afcjlmcol{6}{20}{Red}};
"A"+( 0,  8)*{\afaidcol{}{}{}{}{}{}{Red}{Red}};
"A"+(-2, -8)*{\afawucol{}{}{}{}{}{Red}};
% join one
"A"+(2,-10)*{\afvjcol{12}{Red}};
% middle boxes
"A"+"D"="A";
"A"+(9.5,-10)*{\afcjlmcol{3}{12}{Red}};
"A"+( 2,-8)*{\afawucol{}{}{}{}{}{Red}};
%%%%% GREEN %%%%%
%% cocontractions
(0,0)="A";
%left
"A"+(-11,17)*{\afvjdmcol{4}{\boldsymbol\epsilon}{}{OliveGreen}};
"A"+"D"+(-14,15.5)*{\afvjmcol{23}{OliveGreen}};
"A"+"Dhalf"+(-11,11.5)*{\afvjmcol{11}{OliveGreen}};
%right
"A"+(11,17)*{\afvjdmcol{4}{}{\boldsymbol{\epsilon'}}{OliveGreen}};
"A"+"D"+(14,15.5)*{\afvjmcol{23}{OliveGreen}};
% middle boxes
"A"+"D"="A";
"A"+(-9.5,10)*{\afcjlmcol{3}{12}{OliveGreen}};
"A"+(-2, 8)*{\afawdcol{}{}{}{}{}{OliveGreen}};
% join two
"A"+(-2,-10)*{\afvjcol{12}{OliveGreen}};
% bottom boxes
"A"+"D"="A";
"A"+(-11,14)*{\afcjlmcol{6}{20}{OliveGreen}};
"A"+(11,14)*{\afcjrmcol{6}{20}{OliveGreen}};
"A"+( 0,-8)*{\afaiucol{}{}{}{}{}{}{OliveGreen}{OliveGreen}};
"A"+( 2, 8)*{\afawdcol{}{}{}{}{}{OliveGreen}};
%%%%% BLACK %%%%%
%% cocontractions
(0,0)="A";
%left
"A"+(-8,5.5)*{\afvjm3};
"A"+(-11,11)*{\affr88};
"A"+(-11,11)*{\copy\contrup};
%right
"A"+(8,5.5)*{\afvjm3};
"A"+"Dhalf"+(11,11.5)*{\afvjm{11}};
"A"+(11,11)*{\affr88};
"A"+(11,11)*{\copy\contrup};
%% contractions
"D"+"D"="A";
%left
"A"+(-11,-11.5)-"Dhalf"*{\afvjm{11}};
"A"+(-8,-5.5)*{\afvjm3};
"A"+(-11,-11)*{\affr88};
"A"+(-11,-11)*{\copy\contrdown};
%right
"A"+(8,-5.5)*{\afvjm3};
"A"+(11,-11)*{\affr88};
"A"+(11,-11)*{\copy\contrdown};
% top boxes
(0,0)="A";
"A"+(-5,  0)*{\affr{8}{8}};
"A"+(-6,  2)*{\aflabelright{f_1(\phi)}};
"A"+( 5,  0)*{\affr{8}{8}};
"A"+( 4,  2)*{\aflabelright{g_1(\psi)}};
% middle boxes
"A"+"D"="A";
"A"+(9.5,10)*{\afcjrm{3}{12}};
"A"+(-9.5,-10)*{\afcjrm{3}{12}};
"A"+(-5, 0)*{\affr{8}{8}};
"A"+(-6, 2)*{\aflabelright{f_2(\phi)}};
"A"+( 5, 0)*{\affr{8}{8}};
"A"+( 4, 2)*{\aflabelright{g_2(\psi)}};
% bottom boxes
"A"+"D"="A";
"A"+(-5, 0)*{\affr{8}{8}};
"A"+(-6, 2)*{\aflabelright{f_3(\phi)}};
"A"+( 5, 0)*{\affr{8}{8}};
"A"+( 4, 2)*{\aflabelright{g_3(\psi)}};
}\quad,
\]
where the evidenced interaction and cut vertices belong to the same connected component.
\end{definition}
%---------------

\TODO{Alessio: We cannot identify edges if they do not belong to the same connected component (they might be mapped to from occurrences of different atoms. I will remark somewhere...}

%----------------------------------------------
\begin{theorem}\label{theorem:SoundPathBreaker}
Reduction $\to_\frpb$ is sound; moreover, if\/ $\Phi\to_\frpb\Psi$, then the size of $\Psi$ depends at most cubically on the size of $\Phi$.
\end{theorem}

\begin{proof}
Let $\Phi$ be a derivation with flow $\phi'$, such that $\phi'\to_\frpb\psi'$. We show that there exists a derivation $\Psi$ with flow $\psi'$ and with the same premiss and conclusion as $\Phi$. In the following, we refer to the figure in Definition~\vref{definition:PathBreaker}.

Since the evidenced interaction and cut vertices belong to the same connected component, we assume, by Remark~\vref{remark:AlternativeAiDecomposedForm}, that the following derivation is an $\ai$-decomposed form of $\Phi$:
\[
\vlder{\Phi'}{}
{
 \vlsbr[\beta\;.\;\vlinf{}{}{\fff}{\vls(a^\phi.\bar a^\psi)}]
}
{
 \vlsbr(\vlinf{}{}{\vls[a^\phi.\bar a^\psi]}{\ttt}\;.\;\alpha)
}\quad,
\]
for some atom $a$ and formulae $\alpha$ and $\beta$.

We combine three copies of $\Phi'$ to obtain the desired derivation $\Psi$ with flow $\psi'$ and the same premiss and conclusion as $\Phi$:

\TODO{Make an example of this use of switches:}

\newbox\DeltaTopK
\setbox\DeltaTopK=
\hbox{$
\vlder{\Phi'}{}
{
 \vlsbr[\beta\;.\;(\vlinf{}{}{\ttt}{a^{f_1(\phi)}}\;.\;\bar a^{g_1(\psi)})]
}
{
 \vlsbr(\vlinf{}{}{\vls[a^{f_1(\phi)}.\bar a^{g_1(\psi)}]}{\ttt}\;.\;\alpha)
}
$}
\newbox\DeltaK
\setbox\DeltaK=
\hbox{$
\vlder{\Phi'}{}
{
 \vlsbr[\beta\;.\;(a^{f_2(\phi)}\;.\;\vlinf{}{}{\ttt}{\bar a^{g_2(\psi)}})]
}
{
 \vlsbr([\vlinf{}{}{a^{f_2(\phi)}}{\fff}\;.\;\bar a^{g_2(\psi)}]\;.\;\alpha)
}
$}
\newbox\DeltaBotK
\setbox\DeltaBotK=
\hbox{$
\vlder{\Phi'}{}
{
 \vlsbr[\beta\;.\;\vlinf{}{}{\fff}{\vls(a^{f_3(\phi)}.\bar a^{g_3(\psi)})}]
}
{
 \vlsbr([a^{f_3(\phi)}\;.\;\vlinf{}{}{\bar a^{g_3(\psi)}}{\fff}]\;.\;\alpha)
}
$}
\[
\Psi\quad=\quad
\vlderivation
{
 \vlin{\cod}{}{\beta}
 {
  \vlin{\swi}{}
  {
   \vls
   [
    \vlinf{\cod}{}{\beta}{\vls[\beta.\beta]}
   \;\;\;\;.\;\;\;\;
    \box\DeltaBotK
   ]
  }
  {
   \vlin{\swi}{}
   {
    \vls
    (
%     \vlinf{\swi}{}
%     {
%      \vls
      [
       \beta
      \;\;\;\;.\;\;\;\;
       \box\DeltaK
      ]
%     }
%     {
%      \vls(\vlsmallbrackets[\beta.\bar a^\psi].\alpha)
%     }
    \;\;\;\;\;.\;\;\;\;\;
     \alpha
    )   
   }
   {
    \vlin{\cod}{}
    {
     \vls
     (
      \box\DeltaTopK
     \;\;\;\;.\;\;\;\;
      \vlinf{\cou}{}{\vls(\alpha.\alpha)}{\alpha}
     )
    }
    {
     \vlhy{\alpha}
    }
   }
  }
 } 
}\qquad.
\]
We know that the size of $\Phi'$ depends at most cubically on the size of $\Phi$ by Theorem~\vref{theorem:aiDecomposedForm}, and that the size of $\Psi$ depends at most quadratically on the size of $\alpha$ and $\beta$ by Lemma~\vref{lemma:GenericContraction}, so $\Psi$ depends at most cubically on the size of $\Phi$.
\end{proof}
%----------

\TODO{Alessio: Fixed like the previous Lemma and added reference to $g_1$, $g_2$ and $g_3$.}

%-------------------------------------
\begin{lemma}\label{lemma:PathBreaker}
Given two atomic flows $\phi$ and $\psi$, such that $\phi\to_\frpb\psi$; let $f_1$, $f_2$, $f_3$, $g_1$, $g_2$ and $g_3$ be the isomorphisms, let $\nu_\ai$ be the evidenced cut (resp., interaction) vertex described in the contractum, and let $\nu'_\ai$ be the evidenced cut (resp., interaction) vertex described in the redex of Definition~\ref{definition:PathBreaker}; then, given an interaction (resp., cut) vertex $\nu$ in $\psi$, there is an interaction (resp., cut) vertex $\nu'$ in $\phi$, such that
\begin{itemize}
\item for some $1\le i\le 3$, $\nu=f_i(\nu')$ or $\nu=g_i(\nu')$, or $\nu=\nu_\ai$ and $\nu'=\nu'_\ai$;
\item if there is a path from $\nu$ to $\bot$ (resp., $\top$) in $\psi$, then there is a path from $\nu'$ to $\bot$ (resp., $\top$) in $\phi$; and
\item if there is a cut (resp., interaction) vertex $\hat\nu$ in $\psi$, such that there is a path from $\nu$ to $\hat\nu$ in $\psi$, then there is a cut (resp., interaction) vertex $\hat\nu'$ in $\phi$, such that, for some $1\le i\le 3$, $\hat\nu=f_i(\nu')$ or $\hat\nu=g_i(\nu')$, or $\hat\nu=\nu_\ai$ and $\hat\nu'=\nu'_\ai$; and there is a path from $\nu'$ to $\hat\nu'$ in $\phi$.
\end{itemize}
\end{lemma}

\begin{proof}
In the following we refer to the figure in Definition~\ref{definition:PathBreaker}:
\begin{itemize}
  \item by definition;
  \item any path from $\nu$ to $\top$ (resp., $\bot$) in $\psi$ must contain an edge $\epsilon$, such that, for some upper (resp., lower) edge $\epsilon'$ of $\phi$ and some $1\le i\le 3$, $f_i(\epsilon')=\epsilon$ or $g_i(\epsilon')=\epsilon$. Hence, there is a path from $\nu'$ to $\top$ (resp., $\bot$) in $\phi$; and
 \item we have to consider two cases:
 \begin{itemize}
  \item for some $1\le i\le 3$, $\nu=f_i(\nu')$ and $\hat\nu=f_i(\hat\nu')$, or $\nu=g_i(\nu')$ and $\hat\nu=g_i(\hat\nu')$, then there is a path from $\nu'$ to $\hat\nu'$ in $\phi$; or
  \item $\nu=g_1(\nu')$ and $\hat\nu=g_2(\hat\nu')$, or $\nu=f_2(\nu')$ and $\hat\nu=f_3(\hat\nu')$ (resp., $\nu=g_2(\nu')$ and $\hat\nu=g_1(\hat\nu')$, or $\nu=f_3(\nu')$ and $\hat\nu=f_2(\hat\nu')$),then there is a path from $\nu'$ to $\nu_\ai$ in $\phi$.
 \end{itemize}
\end{itemize}
\end{proof}
%----------

%----------------------------
\newcommand{\PB}{\mathsf{PB}}
\begin{definition}\label{definition:DerPathBreaker}
The \emph{Path Breaker}, $\PB$, is an operator whose arguments are an atom $a$, and a derivation $\Phi$ that is not weakly streamlined with respect to $a$ or with respect to $\bar a$, with $\ai$-decomposed form 
\[
\vlder{\Phi'}{}
{
 \vlsbr
 [
  \beta
 \;.\;
  \vlinf{}{}
  {
   \fff
  }
  {
   \vls(a^\psi.\bar a)
  }
 \;.\;\cdots\;.\;
  \vlinf{}{}
  {
   \fff
  }
  {
   \vls(a^\psi.\bar a)
  }
 ]
}
{
 \vlsbr
 (
  \vlinf{}{}
  {
   \vls[a^\psi.\bar a]
  }
  {
   \ttt
  }
 \;.\;\cdots\;.\;
  \vlinf{}{}
  {
   \vls[a^\psi.\bar a]
  }
  {
   \ttt
  }
 \;.\;
  \alpha
 )
}\quad,
\]
and atomic flow
\[
\phi''\;=\;
\atomicflow
{
(-8, 7)*{\afvjdm{6}{\boldsymbol\epsilon}{}};
( 0, 8)*{\afaidm{}{}{}{}{}{}};
( 8, 7)*{\afvjdm{6}{}{\boldsymbol{\epsilon'}}};
(-5, 0)*{\affr{8}{8}};
(-4, 2)*{\aflabelright{\phi'}};
%---
( 5, 0)*{\affr{8}{8}};
( 6, 2)*{\aflabelright{\psi'}};
( 8,-7)*{\afvjum{6}{}{\boldsymbol{\iota'}}};
( 0,-8)*{\afaium{}{}{}{}{}{}};
(-8,-7)*{\afvjum{6}{\boldsymbol\iota}{}};
}
\quad,
\]
such that occurrences of $a$ do not appear in an interaction or cut instance in $\Phi'$. Consider the derivation
\[
\Psi\;=\;
\vlder{\Phi'}{}
{
 \vlsbr
 [
  \beta
 \;\;\;.\;\;\;
  \vlderivation
  {
   \vlin{}{}
   {
    \fff
   }
   {
    \vlde{}{\{\cod\}}
    {
     \vls(a.\bar a)
    }
    {
     \vlhy
     {
      \vls[(a.\bar a).\cdots.(a.\bar a)]
     }
    }
   }
  }
 ]
}
{
 \vlsbr
 (
  \vlderivation
  {
   \vlde{}{\{\cou\}}
   {
    \vls([a.\bar a].\cdots.[a.\bar a])
   }
   {
    \vlin{}{}
    {
     \vls[a.\bar a]
    }
    {
     \vlhy
     {
      \ttt
     }
    }
   }
  }
 \;\;\;.\;\;\;
  \alpha
 )
}\quad,
\]
with atomic flow
\[
\psi''\;=\;
\atomicflow{
(-11, 11.5)*{\afvjdm{15}{\boldsymbol\epsilon}{}};
( 13, 11.5)*{\afvjdm{15}{}{\boldsymbol{\epsilon'}}};
(  1, 18)*{\afaidex{}{}{}{}{}{}{12}{4}};
%-
( -5, 10)*{\affr68};
( -5, 10)*{\copy\contrup};
( -5,  5)*{\afvjm2};
( -8,  0)*{\affr{8}{8}};
( -4,  2)*{\aflabelleft{\phi'}};
( -5, -5)*{\afvjm2};
( -5,-10)*{\affr68};
( -5,-10)*{\copy\contrdown};
%-
(  7, 10)*{\affr68};
(  7, 10)*{\copy\contrup};
(  7,  5)*{\afvjm2};
( 10,  0)*{\affr{8}{8}};
( 14,  2)*{\aflabelleft{\psi'}};
(  7, -5)*{\afvjm2};
(  7,-10)*{\affr68};
(  7,-10)*{\copy\contrdown};
%-
(  1,-18)*{\afaiuex{}{}{}{}{}{}{12}{4}};
(-11,-11.5)*{\afvjum{15}{\boldsymbol\iota}{}};
( 13,-11.5)*{\afvjum{15}{}{\boldsymbol{\iota'}}};
%----
( -6,  0)*{\affr{14}{30}};
(  1, 13)*{\aflabelleft{\phi}};
(9.5,  0)*{\affr{13}{30}};
( 16, 13)*{\aflabelleft{\psi}};
}\quad.
\]

We then define $\PB(\Phi,a)$ to be such that $\Psi\to_\frpb\PB(\Phi,a)$, where $\phi$ and $\psi$ are the flows, by the same names, shown in Definition~\vref{definition:PathBreaker}.
\end{definition}
%---------------

%------------------------------------------------------------
\begin{proposition}\label{proposition:PathBreaker}
Given an atom $a$, and a derivation $\Phi$ that is not weakly streamlined with respect to both $a$ and $\bar a$,
\begin{enumerate}
\item $\PB(\Phi,a)$ is weakly streamlined with respect to both $a$ and $\bar a$;
\item for any atom $b$, if $\Phi$ is weakly streamlined with respect to $b$, then $\PB(\Phi,a)$ is weakly streamlined with respect to $b$; and
\item the size of\/ $\PB(\Phi,a)$ depends at most cubically on the size of\/ $\Phi$.
\end{enumerate}
\end{proposition}

\begin{proof}
Let $\phi$, $\psi$, $\phi'$, $\psi'$, $\phi''$ and $\psi''$ be the atomic flows given in Definition~\ref{definition:DerPathBreaker} and let $\nu_\aid$ (resp., $\nu_\aiu$) be the evidenced interaction (resp., cut) vertex in $\psi''$, then
\begin{enumerate}
\item by Definition~\ref{definition:DerPathBreaker} all the paths from an interaction (resp., cut) vertex whose edges are mapped to from $a$ or $\bar a$ must start from $\nu_\aid$ (resp., $\nu_\aiu$). In Definition~\ref{definition:PathBreaker} we have colored these edges in red (resp., green). Since the red and the green edges never coincid, there are no paths from $\nu_\aid$ to $\nu_\aiu$;
\item if there is a path from an interaction (resp., cut) vertex in the atomic flow of $\PB(\Phi,a)$ whose edges are mapped to from $b$, then, by Lemma~\vref{lemma:PathBreaker}, there is a path from an interaction (resp., cut) vertex in $\phi$ or $\psi$, so also in $\phi'$ or $\psi'$, whose edges are mapped to from $b$. Hence, the statement follows by contradiction; and
\item the statement follows by Theorem~\vref{theorem:SoundPathBreaker}.
\end{enumerate}
\end{proof}
%----------

%-----------------------------------------
\begin{example}\label{example:PathBreaker}
Given a derivation $\Phi$ where the atoms $a_1$ and $a_2$ occur, such that the atomic flow associated with $\Phi$ is
\[
\atomicflow
{
(-2,8)*{\afaid{}{}{}{}{}{}};
(4,6)*{\afvjm4};
(0,0)*{\affr{10}8};
(5,2)*{\aflabelleft{\phi_1}};
(-4,-6)*{\afvjm4};
(2,-8)*{\afaiu{}{}{}{}{}{}};
}\quad
\atomicflow
{
(-2,8)*{\afaid{}{}{}{}{}{}};
(4,6)*{\afvjm4};
(0,0)*{\affr{10}8};
(5,2)*{\aflabelleft{\phi_2}};
(-4,-6)*{\afvjm4};
(2,-8)*{\afaiu{}{}{}{}{}{}};
}\quad
\atomicflow
{
(0,6)*{\afvjm4};
(0,0)*{\affr88};
(4,2)*{\aflabelleft{\psi}};
(0,-6)*{\afvjm4};
}\quad,
\]

\TODO{Alessio said: `\emph{This is a long shot. Perhaps you can argue a bit more and more clearly about the red edges. Not clear what the latter and former subflows are.}'.}

where all the edges in $\phi_1$ are mapped to from $a_1$ and all the edges in $\phi_2$ are mapped to from $a_2$, and there are no edges in $\psi$ that are mapped to from $a_1$ or $a_2$, then the atomic flow associated with $\PB((\Phi,a_1),a_2)$ is

\TODO{adjust labels}

\TODO{state that we ignore isomorphisms}

\TODO{put flows on one page (how?)}

\[
\atomicflow
{
%cocontraction - top
(4,37.5)*{\afvjm{3}};
(4,32)*{\affr{50}8};
(4,32)*{\copy\contrup};
%contraction - bot
(-4,-32)*{\affr{50}8};
(-4,-32)*{\copy\contrdown};
(-4,-37.5)*{\afvjm{3}};
%---------------------
(4,-18)="D";
(0,-9)="Dhalf";
%----------------
%%first
(-20,0)="B";
% cocontractions
"B"-"D"-"D"-(-12,7)="A";
%left
"A"+"Dhalf"+"Dhalf"+(4,-4)*{\afvjm{42}};
"A"+"Dhalf"+(0,-4)*{\afvjm{24}};
"A"+(-4,-4)*{\afvjm6};
% contractions
"B"+"D"+"D"+(-12,7)="A";
%right
"A"+(4,4)*{\afvjm6};
"A"+(0,4)-"Dhalf"*{\afvjm{24}};
"A"+(-4,4)-"Dhalf"-"Dhalf"*{\afvjm{42}};
%---
% top boxes
"B"-"D"="A";
"A"+(-2, 8)*{\afaid{}{}{}{}{}{}};
"A"+( 0,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join one
"A"+(4,-9)*{\afvjcol{10}{Red}};
% middle boxes
"B"="A";
"A"+(-4, 8)*{\afawd{}{}{}{}{}};
"A"+( 4,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join two
"A"+(0,-9)*{\afvjcol{10}{Red}};
% bottom boxes
"B"+"D"="A";
"A"+(2,-8)*{\afaiu{}{}{}{}{}{}};
"A"+(0, 8)*{\afawd{}{}{}{}{}};
"A"+(0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
%----------------
%%second
(0,0)="B";
% cocontractions
"B"-"D"-"D"-(-12,7)="A";
%left
"A"+"Dhalf"+"Dhalf"+(4,-4)*{\afvjm{42}};
"A"+"Dhalf"+(0,-4)*{\afvjm{24}};
"A"+(-4,-4)*{\afvjm6};
% contractions
"B"+"D"+"D"+(-12,7)="A";
%right
"A"+(4,4)*{\afvjm6};
"A"+(0,4)-"Dhalf"*{\afvjm{24}};
"A"+(-4,4)-"Dhalf"-"Dhalf"*{\afvjm{42}};
%---
% top boxes
"B"-"D"="A";
"A"+(-2, 8)*{\afaid{}{}{}{}{}{}};
"A"+( 0,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join one
"A"+(4,-9)*{\afvjcol{10}{Red}};
% middle boxes
"B"="A";
"A"+(-4, 8)*{\afawd{}{}{}{}{}};
"A"+( 4,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join two
"A"+(0,-9)*{\afvjcol{10}{Red}};
% bottom boxes
"B"+"D"="A";
"A"+(2,-8)*{\afaiu{}{}{}{}{}{}};
"A"+(0, 8)*{\afawd{}{}{}{}{}};
"A"+(0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
%----------------
%%third
(20,0)="B";
% cocontractions
"B"-"D"-"D"-(-12,7)="A";
%left
"A"+"Dhalf"+"Dhalf"+(4,-4)*{\afvjm{42}};
"A"+"Dhalf"+(0,-4)*{\afvjm{24}};
"A"+(-4,-4)*{\afvjm6};
% contractions
"B"+"D"+"D"+(-12,7)="A";
%right
"A"+(4,4)*{\afvjm6};
"A"+(0,4)-"Dhalf"*{\afvjm{24}};
"A"+(-4,4)-"Dhalf"-"Dhalf"*{\afvjm{42}};
%---
% top boxes
"B"-"D"="A";
"A"+(-2, 8)*{\afaid{}{}{}{}{}{}};
"A"+( 0,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join one
"A"+(4,-9)*{\afvjcol{10}{Red}};
% middle boxes
"B"="A";
"A"+(-4, 8)*{\afawd{}{}{}{}{}};
"A"+( 4,-8)*{\afawu{}{}{}{}{}};
"A"+( 0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
% join two
"A"+(0,-9)*{\afvjcol{10}{Red}};
% bottom boxes
"B"+"D"="A";
"A"+(2,-8)*{\afaiu{}{}{}{}{}{}};
"A"+(0, 8)*{\afawd{}{}{}{}{}};
"A"+(0, 0)*{\affr{10}{8}};
"A"+( 2, 2)*{\aflabelright{\phi_1}};
}
\]
\[
\atomicflow
{
(12,-50)="D";
% cocontractions
(18,-11)="A";
%
"A"+(6,5.5)*{\afvjm3};
"A"+(6,0)*{\affr{34}8};
"A"+(6,0)*{\copy\contrup};
"A"+(2,-29)*{\afvjm{50}};
"A"+(6,-29)*{\afvjm{50}};
"A"+(10,-33)*{\afvjm{58}};
"A"+(14,-54)*{\afvjm{100}};
"A"+(18,-54)*{\afvjm{100}};
"A"+(22,-58)*{\afvjm{108}};
% === BOX ONE ===
(0,-27)="A";
%-
"A"+( -6,24)*{\afaidex{}{}{}{}{}{}31};
%-
"A"+(-12,16)*{\affr{10}8};
"A"+(-12,16)*{\copy\contrup};
"A"+(  0,16)*{\affr{10}8};
"A"+(  0,16)*{\copy\contrup};
%-
"A"+(-16,8)*{\afvj8};
"A"+(-8,8)*{\afcjr88};
"A"+(0,8)*{\afcjrm{16}8};
%
"A"+(-8,8)*{\afcjl88};
"A"+(0,8)*{\afvj8};
"A"+(8,8)*{\afcjrm88};
%
"A"+(0,8)*{\afcjl{16}8};
"A"+(8,8)*{\afcjl88};
"A"+(16,8)*{\afvjm8};
%-
"A"+(-12,0)*{\affr{10}8};
"A"+(0,0)*{\affr{10}8};
"A"+(12,0)*{\affr{10}8};
"A"+(-10,2)*{\aflabelright{\phi_2}};
"A"+(2,2)*{\aflabelright{\phi_2}};
"A"+(14,2)*{\aflabelright{\phi_2}};
%-
"A"+(-8,-8)*{\afcjl88};
"A"+(0,-8)*{\afcjlcol{16}8{Red}};
%-
"A"+(-8,-8)*{\afcjrm88};
"A"+(0,-8)*{\afvj8};
"A"+(8,-8)*{\afcjlcol88{Red}};
%
"A"+(0,-8)*{\afcjrm{16}8};
"A"+(8,-8)*{\afcjr88};
"A"+(16,-8)*{\afvjcol8{Red}};
%
"A"+(  0,-16)*{\affr{10}8};
"A"+(  0,-16)*{\copy\contrdown};
"A"+( 12,-16)*{\affr{10}8};
"A"+( 12,-16)*{\copy\contrdown};
%---
"A"+(0,-24)*{\afawu{}{}{}{}};
"A"+(12,-25)*{\afvjcol{10}{Red}};
% === BOX TWO ===
"A"+"D"="A";
%-
"A"+(-12,24)*{\afawd{}{}{}{}};
%-
"A"+(-12,16)*{\affr{10}8};
"A"+(-12,16)*{\copy\contrup};
"A"+(  0,16)*{\affr{10}8};
"A"+(  0,16)*{\copy\contrup};
%-
"A"+(-16,8)*{\afvj8};
"A"+(-8,8)*{\afcjrcol88{Red}};
"A"+(0,8)*{\afcjrm{16}8};
%
"A"+(-8,8)*{\afcjl88};
"A"+(0,8)*{\afvjcol8{Red}};
"A"+(8,8)*{\afcjrm88};
%
"A"+(0,8)*{\afcjl{16}8};
"A"+(8,8)*{\afcjlcol88{Red}};
%-
"A"+(-12,0)*{\affr{10}8};
"A"+(0,0)*{\affr{10}8};
"A"+(12,0)*{\affr{10}8};
"A"+(-10,2)*{\aflabelright{\phi_2}};
"A"+(2,2)*{\aflabelright{\phi_2}};
"A"+(14,2)*{\aflabelright{\phi_2}};
%-
"A"+(-8,-8)*{\afcjlcol88{Red}};
"A"+(0,-8)*{\afcjl{16}8};
%-
"A"+(-8,-8)*{\afcjrm88};
"A"+(0,-8)*{\afvjcol8{Red}};
"A"+(8,-8)*{\afcjl88};
%
"A"+(0,-8)*{\afcjrm{16}8};
"A"+(8,-8)*{\afcjrcol88{Red}};
"A"+(16,-8)*{\afvj8};
%
"A"+(  0,-16)*{\affr{10}8};
"A"+(  0,-16)*{\copy\contrdown};
"A"+( 12,-16)*{\affr{10}8};
"A"+( 12,-16)*{\copy\contrdown};
%---
"A"+(12,-24)*{\afawu{}{}{}{}};
"A"+(0,-25)*{\afvjcol{10}{Red}};
% === BOX THREE ===
"A"+"D"="A";
%-
"A"+(  0,24)*{\afawd{}{}{}{}};
%-
"A"+(-12,16)*{\affr{10}8};
"A"+(-12,16)*{\copy\contrup};
"A"+(  0,16)*{\affr{10}8};
"A"+(  0,16)*{\copy\contrup};
%-
"A"+(-16,8)*{\afvjcol8{Red}};
"A"+(-8,8)*{\afcjr88};
"A"+(0,8)*{\afcjrm{16}8};
%
"A"+(-8,8)*{\afcjlcol88{Red}};
"A"+(0,8)*{\afvj8};
"A"+(8,8)*{\afcjrm88};
%
"A"+(0,8)*{\afcjlcol{16}8{Red}};
"A"+(8,8)*{\afcjl88};
%-
"A"+(-12,0)*{\affr{10}8};
"A"+(0,0)*{\affr{10}8};
"A"+(12,0)*{\affr{10}8};
"A"+(-10,2)*{\aflabelright{\phi_2}};
"A"+(2,2)*{\aflabelright{\phi_2}};
"A"+(14,2)*{\aflabelright{\phi_2}};
%-
"A"+(-16,-8)*{\afvjm8};
"A"+(-8,-8)*{\afcjl88};
"A"+(0,-8)*{\afcjl{16}8};
%-
"A"+(-8,-8)*{\afcjrm88};
"A"+(8,-8)*{\afcjl88};
"A"+(0,-8)*{\afvj8};
%
"A"+(0,-8)*{\afcjrm{16}8};
"A"+(8,-8)*{\afcjr88};
"A"+(16,-8)*{\afvj8};
%
"A"+(  0,-16)*{\affr{10}8};
"A"+(  0,-16)*{\copy\contrdown};
"A"+( 12,-16)*{\affr{10}8};
"A"+( 12,-16)*{\copy\contrdown};
%-
"A"+(  6,-24)*{\afaiuex{}{}{}{}{}{}31};
%---
"A"+(-20,-16)="A";
"A"+(-20,58)*{\afvjm{108}};
"A"+(-16,54)*{\afvjm{100}};
"A"+(-12,54)*{\afvjm{100}};
"A"+(-8,33)*{\afvjm{58}};
"A"+(-4,29)*{\afvjm{50}};
"A"+( 0,29)*{\afvjm{50}};
"A"+(-4,0)*{\affr{34}8};
"A"+(-4,0)*{\copy\contrdown};
"A"+(-4,-5.5)*{\afvjm3};
}
\]
\[
\atomicflow{
(0,34.5)*{\afvjm3};
(0,29)*{\affr{82}8};
(0,29)*{\copy\contrup};
%
(0,-29)*{\affr{82}8};
(0,-29)*{\copy\contrdown};
(0,-34.5)*{\afvjm3};
%-------------------
(30,0)="B";
%---------------
(0,0)-"B"="A";
"A"+(-10,14.5)*{\afvjm{21}};
"A"+(0,14.5)*{\afvjm{21}};
"A"+(10,14.5)*{\afvjm{21}};
%---
"A"+(-10,0)*{\affr88};
"A"+( -9,2)*{\aflabelright\psi};
"A"+(  0,0)*{\affr88};
"A"+(  1,2)*{\aflabelright\psi};
"A"+( 10,0)*{\affr88};
"A"+( 11,2)*{\aflabelright\psi};
%---
"A"+(-10,-14.5)*{\afvjm{21}};
"A"+(0,-14.5)*{\afvjm{21}};
"A"+(10,-14.5)*{\afvjm{21}};
%---------------
(0,0)="A";
%---
"A"+(-10,14.5)*{\afvjm{21}};
"A"+(0,14.5)*{\afvjm{21}};
"A"+(10,14.5)*{\afvjm{21}};
%---
"A"+(-10,0)*{\affr88};
"A"+( -9,2)*{\aflabelright\psi};
"A"+(  0,0)*{\affr88};
"A"+(  1,2)*{\aflabelright\psi};
"A"+( 10,0)*{\affr88};
"A"+( 11,2)*{\aflabelright\psi};
%---
"A"+(-10,-14.5)*{\afvjm{21}};
"A"+(0,-14.5)*{\afvjm{21}};
"A"+(10,-14.5)*{\afvjm{21}};
%---------------
"A"+"B"="A";
%---
"A"+(-10,14.5)*{\afvjm{21}};
"A"+(0,14.5)*{\afvjm{21}};
"A"+(10,14.5)*{\afvjm{21}};
%---
"A"+(-10,0)*{\affr88};
"A"+( -9,2)*{\aflabelright\psi};
"A"+(  0,0)*{\affr88};
"A"+(  1,2)*{\aflabelright\psi};
"A"+( 10,0)*{\affr88};
"A"+( 11,2)*{\aflabelright\psi};
%---
"A"+(-10,-14.5)*{\afvjm{21}};
"A"+(0,-14.5)*{\afvjm{21}};
"A"+(10,-14.5)*{\afvjm{21}};
}\quad.
\]
By comparing the subflow containing $\phi_1$ with the subflow containing $\phi_2$ above, we can see why the procedure is non-confluent: We could modify our procedure in several ways to make the two subflows more similar. However, we can see no way of avoiding the fact that there are more paths passing through the edges marked in red in the latter than in the former subflow.
\end{example}
%------------