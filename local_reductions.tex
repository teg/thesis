%======================================
\chapter{Local Reductions}

\begin{definition}\label{definition:FlowGraphicalExpressions}
In Figure~\vref{figure:ReductionRules}, we define graphical expressions of the kind $r\colon\phi'\to\psi'$, where $r$ is a name and $\phi'$ and $\psi'$ are flows.
\end{definition}

\TODO{In Figures~\vref{figure:ReductionRules}, \vref{figure:ReductionRulesWeakening} and \vref{figure:ReductionRulesContraction} extend the edges so the atomic flows on either side of the arrow has equal height.}

\newcommand{\rwdcd}{{{\mathsf w}{\downarrow}{\hbox{-}}{\mathsf c}{\downarrow}}}
\newcommand{\rwdiu}{{{\mathsf w}{\downarrow}{\hbox{-}}{\mathsf i}{\uparrow  }}}
\newcommand{\rwdwu}{{{\mathsf w}{\downarrow}{\hbox{-}}{\mathsf w}{\uparrow  }}}
\newcommand{\rwdcu}{{{\mathsf w}{\downarrow}{\hbox{-}}{\mathsf c}{\uparrow  }}}
\newcommand{\rcuwu}{{{\mathsf c}{\uparrow  }{\hbox{-}}{\mathsf w}{\uparrow  }}}
\newcommand{\rcdwu}{{{\mathsf c}{\downarrow}{\hbox{-}}{\mathsf w}{\uparrow  }}}
\newcommand{\rcdiu}{{{\mathsf c}{\downarrow}{\hbox{-}}{\mathsf i}{\uparrow  }}}
\newcommand{\rcdcu}{{{\mathsf c}{\downarrow}{\hbox{-}}{\mathsf c}{\uparrow  }}}
\newcommand{\ridwu}{{{\mathsf i}{\downarrow}{\hbox{-}}{\mathsf w}{\uparrow  }}}
\newcommand{\ridcu}{{{\mathsf i}{\downarrow}{\hbox{-}}{\mathsf c}{\uparrow  }}}
%---------------------------------------
\begin{figure}[tbp]
\[
\begin{array}{@{}c@{}c@{}}
%-------------------
\rwdcd\colon\quad\afraise{\atomicflow{
( 0  ,0)*{\afacd{}{}{}\one{}\two};
(-2  ,4)*{\afawdnw{}{}};
(-3.5,0)*{\invisiblemark};
( 3.5,0)*{\invisiblemark}}}
\quad\to\quad
\atomicflow{
( 0  ,3.3)*{\aflabelright{\one,\two}};
( 0  ,3  )*{\afvj8};
(-1.5,0  )*{\invisiblemark};
( 3  ,0  )*{\invisiblemark}}
&\qquad
%-------------------
\rcuwu\colon\quad\aflower{\atomicflowinv{
( 0  ,0)*{\afacu{}{}{}\two{}\one};
(-2  ,6)*{\afawunw{}{}};
( 3.5,0)*{\invisiblemark}}}
\quad\to\quad
\atomicflow{
(0,3  )*{\afvj8};
(0,3.3)*{\aflabelright{\one,\two}};
(3,0  )*{\invisiblemark}}
\\
%-------------------
\rwdiu\colon\quad\atomicflow{
( 0  ,0)*{\afaiu{}{}{}\one{}{}};
(-2  ,4)*{\afawdnw{}{}};
(-3.5,0)*{\invisiblemark};
( 3.5,0)*{\invisiblemark}}
\quad\to\quad
\aflower{\atomicflow{
( 0  ,0)*{\afawu{}{}{}\one};
(-1.5,0)*{\invisiblemark};
( 1.5,0)*{\invisiblemark}}}
&\qquad
%-------------------
\ridwu\colon\quad\atomicflowinv{
( 0  ,0)*{\afaid{}{}{}\one{}{}};
(-2  ,6)*{\afawunw{}{}};
( 3.5,0)*{\invisiblemark}}
\quad\to\quad
\afraise{\atomicflowinv{
(0  ,0)*{\afawd{}{}{}\one};
(1.5,0)*{\invisiblemark}}}
\\
%-------------------
\multispan2{\hfil$
\rwdwu\colon\quad\atomicflow{
( 0  ,6)*{\afawd{}{}{}{}};
( 0  ,0)*{\afawunw{}{}{}{}};
(-1.5,0)*{\invisiblemark};
( 1.5,0)*{\invisiblemark}}
\quad\to\quad
\atomicflow{}
$\hfil}\\
%-------------------
\rwdcu\colon\quad\afraise{\atomicflow{
( 0  ,-4)*{\afacu\one{}{}\two{}{}};
( 0  , 0)*{\afawdnw{}{}};
(-3.5, 0)*{\invisiblemark};
( 3.5, 0)*{\invisiblemark}}}
\quad\to\quad
\atomicflow{
(-2  ,-4)*{\afawd{}{}\one{}};
( 2  ,-4)*{\afawd{}{}{}\two};
(-3.5, 0)*{\invisiblemark};
( 3.5, 0)*{\invisiblemark}}
&\qquad
%-------------------
\rcdwu\colon\quad\aflower{\atomicflowinv{
( 0  ,-4)*{\afacd\one{}{}\two{}{}};
( 0  , 2)*{\afawunw{}{}};
(-3.5, 0)*{\invisiblemark};
( 3.5, 0)*{\invisiblemark}}}
\quad\to\quad
\atomicflowinv{
(-2  ,-4)*{\afawu{}{}\one{}};
( 2  ,-4)*{\afawu{}{}{}\two};
(-3.5, 0)*{\invisiblemark};
( 3.5, 0)*{\invisiblemark}}
\\
%-------------------
\rcdiu\colon\quad\aflower{\atomicflow{
(   6, 8)*{\afvjd8{}\three{}{}};
(   3, 0)*{\afaiuex{}{}{}{}{}{}32};
(   0, 8)*{\afacd\one{}{}\two{}{}};
(-3.5, 0)*{\invisiblemark};
( 7.5, 0)*{\invisiblemark}}}
\quad\to\quad
\aflower{\atomicflow{
(  10,8)*{\afacu{}{}{}{}{}\three};
(   0,8)*{\afvjd8\one{}};
(   4,8)*{\afvjd8{}\two};
(   6,2)*{\afaiunw{}{}};
(   6,0)*{\afaiuex{}{}{}{}{}{}31}}}
&\qquad
%-------------------
\ridcu\colon\quad\afraise{\atomicflowinv{
(   6,8)*{\afvju8{}\three{}{}};
(   3,0)*{\afaidex {}{}{}{}{}{}32};
(   0,8)*{\afacu\one{}{}\two{}{}};
(-3.5,0)*{\invisiblemark};
( 7.5,0)*{\invisiblemark}}}
\quad\to\quad
\afraise{\atomicflowinv{
(  10,8)*{\afacd{}{}{}{}{}\three};
(   0,8)*{\afvju8\one{}};
(   4,8)*{\afvju8{}\two};
(   6,4)*{\afaidnw{}{}};
(   6,0)*{\afaidex{}{}{}{}{}{}31}}}
\\
%-------------------
\multispan2{\hfil$
\rcdcu\colon\quad\atomicflow{
( 0,4)*{\afacd\one{}{}\two{}{}};
( 0,-4)*{\afacu\three{}{}\four{}{}};
(-4,0)*{\invisiblemark};
( 4,0)*{\invisiblemark}}
\quad\to\quad
\atomicflow{
(0,12)*{\afacu{}{}{}{}\one{}};
(6,12)*{\afacu{}{}{}{}{}\two};
( 0,0)*{\afacd{}{}{}{}\three{}};
( 6,0)*{\afacd{}{}{}{}{}\four};
(-2,6)*{\afvj4};
( 8,6)*{\afvj4};
( 3,6)*{\afex24}}
$\hfil}\\
%%-------------------
\end{array}
\]
\caption{Atomic-flow reduction rules.}
\label{figure:ReductionRules}
\end{figure}%

%---------------------------------------
\begin{example}\label{example:NoPolarityAssignment}
The `reduction' on the left, when used inside a larger atomic flow, might create a situation as on the right:
\nopagebreak[4]\medskip\afnegspace
\[
\atomicflow{
( 0  ,0)*{\afacu{}{}{}{}{}{}};
( 0  ,4)*{\afawdnw{}{}}}
\quad\to\quad
\atomicflow{
(0,8)*{\invisiblemark};
( 0  ,0)*{\afaid{}{}{}{}{}{}}}
\qquad\qquad
\atomicflow{
( 0  , 8)*{\afacu{}{}{}{}\ppl{}};
( 0  ,12)*{\afawdnw{}{}};
(-2  , 4)*{\aflabelleft\ppl};
( 2  , 4)*{\aflabelright\ppl};
( 0  , 0)*{\afacd{}{}{}{}\ppl{}};
(-3.5, 0)*{\invisiblemark};
( 3.5, 0)*{\invisiblemark}}
\quad\to\quad
\atomicflow{
(0,16)*{\invisiblemark};
( 0  ,4)*{\afaidnw{}{}};
( 0  ,0)*{\afacd\ppl{}{}{\scriptstyle?}\ppl{}};
(-3.5,0)*{\invisiblemark};
( 3.5,0)*{\invisiblemark}}
\quad,
\] 
where the graph at the right is not an atomic flow, for lack of a polarity assignment.
\end{example}

This prompts us to define reduction rules for atomic flows as follows.

%---------------------------------------
\begin{definition}\label{definition:FlowReductionRule}
An (\emph{atomic-flow}) \emph{reduction rule $r$ from flow $\phi'$ to flow $\psi'$}\index{reduction!rule} is a quadruple $(\phi',\psi',f,g)$ such that:
\begin{enumerate}
\item $f$ is a one-to-one map from the upper edges of $\phi'$ to the upper edges of $\psi'$,
\item $g$ is a one-to-one map from the lower edges of $\phi'$ to the lower edges of $\psi'$,
\item for every polarity assignment $\pi$ for $\phi'$, there is a polarity assignment $\pi'$ for $\psi'$ such that $\pi'(f(\epsilon))=\pi(\epsilon)$ and $\pi'(g(\epsilon'))=\pi(\epsilon')$, for any upper edge $\epsilon$ and any lower edge $\epsilon'$ of $\phi'$;
\end{enumerate}
we define reduction rules with graphical expressions $r\colon\phi'\to\psi'$, where $f$ and $g$ are indicated by labelling edges. For every reduction rule $r\colon\phi'\to\psi'$, the reduction ${\to_r}$ is defined, such that $\phi\to_r\psi$ if and only if $\phi'$ appears as a subgraph in $\phi$ and we obtain $\psi$ by replacing $\phi'$ with $\psi'$ in $\phi$, while respecting the correspondence of edges; we call this operation a \emph{reduction by $r$}\index{reduction!by rule}.
\end{definition}

\TODO{Consider making a remark about conserving polarity assignments.}

\begin{remark}\label{remark:FlowReductionRuleProperFlow}
The condition on polarity assignments for a reduction rule $r$ guarantees that the $\psi$ in $\phi\to_r\psi$ is a proper atomic flow, if $\phi$ is one.
\end{remark}

\begin{remark}\label{remark:FlowReductionRuleNoConnect}
Because of the condition on polarity assignments for reduction rules, two distinct connected components in a flow cannot be connected by a reduction. To see that this is impossible, consider the following `reduction rule', which violates the condition on polarity assignments:
\[
\aflower{\atomicflow{
(-2,0)*{\afawu{}{}{}{}};
( 2,0)*{\afawu{}{}{}{}}}}
\quad\to\quad
\aflower{\atomicflow{
( 0  , 2)*{\afaiu{}{}{}{}{}{}}}}
\quad.
\]
\afnegspace
For this `reduction rule' there exist both valid (left) and invalid (right) polarity assignments:
\[
\aflower{\atomicflow{
(-2  ,0)*{\afawu{}{}\ppl{}};
( 2  ,0)*{\afawu{}{}{}\pmi};
(-3.5,0)*{\invisiblemark};
( 3.5,0)*{\invisiblemark}}}
\quad\to\quad
\aflower{\atomicflow{
( 0  ,2)*{\afaiu\ppl{}{}\pmi{}{}};
(-3.5,0)*{\invisiblemark};
( 3.5,0)*{\invisiblemark}}}
\qquad\qquad
\aflower{\atomicflow{
(-2,0)*{\afawu{}{}\ppl{}};
( 2,0)*{\afawu{}{}{}\ppl};
(-3.5,0)*{\invisiblemark};
( 3.5,0)*{\invisiblemark}}}
\quad\to\quad
\aflower{\atomicflow{
( 0  , 2)*{\afaiu\ppl{}{}{\scriptstyle?}{}{}};
(-3.5, 0)*{\invisiblemark};
( 3.5, 0)*{\invisiblemark}}}
\quad.
\]
\afnegspace
\end{remark}

It is immediate to check:

\begin{proposition}\label{proposition:ValidReductionRules}
The graphical expressions in Figure~\vref{figure:ReductionRules} are atomic-flow reduction rules.
\end{proposition}

%---------------------------------------
\begin{definition}\label{definition:FlowRewritingSystem}
A finite set of reduction rules is a \emph{flow rewriting system}\index{flow rewriting system}. For every flow rewriting system $F=\{r_1,\dots,r_h\}$ we define ${\to_F}={\to_{r_1}\cup\cdots\cup{\to_{r_h}}}$. The reflexive transitive closure of $\to_F$ is denoted by $\to_F^\star$. Given a set of atomic flows $S$, we say that a flow rewriting system $F$ is \emph{terminating on $S$}\index{flow rewriting system!terminating} if there is no infinite chain $\phi_1\to_F\phi_2\to_F\cdots$, for every $\phi_1\in S$; if $F$ is terminating on the set of atomic flows, we say that it is \emph{terminating}. We say that atomic flow $\phi$ is \emph{normal}\index{flow rewriting system!normal} for flow rewriting system $F$ if there is no atomic flow $\psi$ such that $\phi\to_F\psi$.
\end{definition}

\newcommand{\frw}{{\mathsf w}}
%---------------------------------------
\begin{definition}\label{definition:FlowRewritingWeakening}
The following flow rewriting system is called $\frw$:
\[
\{\;\rwdcd\;,\;\rcuwu\;,\;\rwdiu\;,\;\ridwu\;,\;\rwdwu\;,\;\rwdcu\;,\;\rcdwu\;\}
\quad.
\]
\end{definition}

\newcommand{\frc}{{\mathsf c}}
%---------------------------------------
\begin{definition}\label{definition:FlowRewritingContraction}
The following flow rewriting system is called $\frc$:
\[
\{\;\rcdiu\;,\;\ridcu\;,\;\rcdcu\;\}\quad.
\]
\end{definition}

%=======================================
\section{Soundness}\label{section:soundness}

%---------------------------------------
\begin{definition}\label{definition:SoundRedcutionRule}
A reduction rule $r$ is \emph{sound}\index{reduction!rule!sound} if $\to_r$ is sound.
\end{definition}

The proof of the following theorem is essentially contained in Figures~\vref{figure:ReductionRulesWeakening} and \vref{figure:ReductionRulesContraction}.

%---------------------------------------
\begin{figure}[tbp]
\[
\begin{array}{@{}l@{}c@{}}
%---------------------------------------
\rwdcd\colon\hfil\afraise{\atomicflow{
( 0  ,0)*{\afacd\three{}{}\one{}\two};
(-2  ,4)*{\afawdnw{}{}};
(-3.5,0)*{\invisiblemark};
( 3.5,0)*{\invisiblemark}}}
\quad\to\quad
\atomicflow{
( 0  ,3.3)*{\aflabelright{\one,\two}};
( 0  ,3  )*{\afvj8};
(-1.5,0  )*{\invisiblemark};
( 3  ,0  )*{\invisiblemark}}
&\qquad
\vlder{\Phi}{}{\zeta\left\{\vlinf{}{}{a^\two}{\vls[a^\three.a^\one]}\right\}}
              {\xi\left\{\vlinf{}{}{a^\three}{\fff}\right\}}
\quad\to_\rwdcd\quad
\vlder{\Phi\{a^\three/\fff\}}{}{\zeta\left\{\vlinf{=}{}{a^{\one,\two}}{\vls[\fff.a^{\one,\two}]}\right\}}
              {\xi\{\fff\}}
\\
\noalign{\bigskip}
%---------------------------------------
\rwdiu\colon\hfil\atomicflow{
( 0  ,0)*{\afaiu\two {}{}\one{}{}};
(-2  ,4)*{\afawdnw{}{}};
(-3.5,0)*{\invisiblemark};
( 3.5,0)*{\invisiblemark}}
\quad\to\quad
\aflower{\atomicflow{
( 0  ,0)*{\afawu{}{}{}\one};
(-1.5,0)*{\invisiblemark};
( 1.5,0)*{\invisiblemark}}}
&\qquad
\vlder{\Phi}{}{\zeta\left\{\vlinf{}{}{\fff}{\vls(a^\two.\bar a^\one)}\right\}}
              {\xi\left\{\vlinf{}{}{a^\two}{\fff}\right\}}
\quad\to_\rwdiu\quad
\vlder{\Phi\{a^\two/\fff\}}{}{\zeta\left\{\vlinf{=}{}{\fff}{\vls(\fff\;.\;\vlinf{}{}{\ttt}{\bar a^\one})}\right\}}
              {\xi\{\fff\}}
\\
\noalign{\bigskip}
%---------------------------------------
\rwdwu\colon\hfil\atomicflow{
( 0  ,6)*{\afawd{}{}{}\one};
( 0  ,0)*{\afawunw{}{}{}{}};
(-1.5,0)*{\invisiblemark};
( 1.5,0)*{\invisiblemark}}
\quad\to\quad
\atomicflow{}
&\qquad
\vlder{\Phi}{}{\zeta\left\{\vlinf{}{}{\ttt}{a^\one}\right\}}
              {\xi\left\{\vlinf{}{}{a^\one}{\fff}\right\}}
\quad\to_\rwdwu\quad
\vlder{\Phi\{a^\one/\fff\}}{}{\zeta\left\{\vlderivation
                           {
                            \vlin{=}{}{\ttt}
                            {
                             \vlin{\swi}{}{\vls[(\fff.\fff).\ttt]}
                             {
                              \vlin{=}{}{\vls(\fff.[\fff.\ttt])}
                              {
                               \vlhy{\fff}
                              }
                             }
                            }
                           }\right\}}
              {\xi\{\fff\}}
\\
\noalign{\bigskip}
%---------------------------------------
\rwdcu\colon\hfil\afraise{\atomicflow{
( 0  ,-4)*{\afacu\one{}{}\two{}\three};
( 0  , 0)*{\afawdnw{}{}};
(-3.5, 0)*{\invisiblemark};
( 3.5, 0)*{\invisiblemark}}}
\quad\to\quad
\atomicflow{
(-2  ,-4)*{\afawd{}{}\one{}};
( 2  ,-4)*{\afawd{}{}{}\two};
(-3.5, 0)*{\invisiblemark};
( 3.5, 0)*{\invisiblemark}}
&\qquad
\vlder{\Phi}{}{\zeta\left\{\vlinf{}{}{\vls(a^\one.a^\two)}{a^\three}\right\}}
              {\xi\left\{\vlinf{}{}{a^\three}{\fff}\right\}}
\quad\to_\rwdcu\quad
\vlder{\Phi\{a^\three/\fff\}}{}{\zeta\left\{\vlinf{=}{}{\vls(\vlinf{}{}{a^\one}{\fff}\;.\;\vlinf{}{}{a^\two}{\fff})}{\fff}\right\}}
              {\xi\{\fff\}}
\\
%---------------------------------------
\end{array}
\]
\caption{`Downwards' reduction rules for weakening and their soundness.}
\label{figure:ReductionRulesWeakening}
\end{figure}%

\newbox\ContDownIntUp
\setbox\ContDownIntUp=
\hbox{$
\vlderivation
{
 \vlin{}{}{\fff}
 {
  \vlin{=}{}{\vlsbr(\vlinf{\swi}{}{\vlinf{=}{}{a^\one}{\vlsbr[\vlinf{}{}{\fff}{\vls(\bar a.a^\two)}\;.\;a^\one]}}{\vls(\bar a.[a^\two.a^\one])}\;\;\;.\;\;\;\bar a)}
  {
   \vlhy{\vlsbr([a^\one.a^\two]\;.\;\vlinf{}{}{\vls(\bar a.\bar a)}{\bar a^\three})}
  }
 }
}
$}
\newbox\ContDownContUp
\setbox\ContDownContUp=
\hbox{$
\vlinf{\med}{}{\vlsbr(\vlinf{}{}{a^\three}{\vls[a.a]}\;.\;\vlinf{}{}{a^\four}{\vls[a.a]})}
              {\vlsbr[\vlinf{}{}{\vls(a.a)}{a^\one}\;.\;\vlinf{}{}{\vls(a.a)}{a^\two}]}
$}
\newbox\ContDown
\setbox\ContDown=
\hbox{$
\vlinf\swi{}{
			 \vlsbr[\vlderivation
			        {
			         \vlin\swi{}
			         {
			          \vls[\vlinf{}{}
                           {\fff}
                           {\vls(\bar a.a^\one)}
                          .
                           \vlinf{}{}
                           {\fff}
                           {\vls(\bar a.a^\two)}
                          ]
                     }
                     {
                      \vlin\swi{}
                      {
                       \vls(\bar a.[(\bar a.a^\one).a^\two])
                      }
                      {
                       \vlhy
                       {\vls(\vlinf{}{}
                             {\vls(\bar a.\bar a)}
                             {\bar a}          
                            .
                             [a^\one.a^\two]
                            )
                       }
                      }
                     }
                    }
                   \;\;\;.
                    {a^\three}
                   ]
            }
            {
             \vls(\vlinf{}{}
                  {\vls[\bar a.a^\three]}
                  {\ttt}
                 .
                  [a^\one.a^\two]
                 )
            }
$}
%---------------------------------------
\begin{figure}[tbp]
\[
\begin{array}{@{}l@{}c@{}}
%---------------------------------------
\rcdiu\colon\aflower{\atomicflow{
(   6, 8)*{\afvjd8{}\three{}{}};
(   3, 0)*{\afaiuex{}\four{}{}{}{}32};
(   0, 8)*{\afacd\one{}{}\two{}{}};
(-3.5, 0)*{\invisiblemark};
( 7.5, 0)*{\invisiblemark}}}
\quad\to\quad
\aflower{\atomicflow{
(10,8)*{\afacu{}{}{}{}{}\three};
( 0,8)*{\afvjd8\one{}};
( 4,8)*{\afvjd8{}\two};
( 6,2)*{\afaiunw{}{}};
( 6,0)*{\afaiuex{}{}{}{}{}{}31}}}
&\qquad
\vlder{\Phi}{}{\zeta\left\{\vlinf{}{}{\fff}{\vls(a^\four.\bar a^\three)}\right\}}
              {\xi\left\{\vlinf{}{}{a^\four}{\vls[a^\one.a^\two]}\right\}}
\quad\to_\rcdiu\quad
\vlder{\Phi\{a^\four/\vlsmallbrackets\vlsbr[a^\one.a^\two]\}}{}{\zeta\left\{\box\ContDownIntUp\right\}}
                                     {\xi\left\{\vls[a^\one.a^\two]\right\}}
\\
\noalign{\bigskip}
%---------------------------------------
\rcdcu\colon\hfil\atomicflow{
( 0, 4)*{\afacd\one{}{}\two{}{}};
( 0, 0)*{\aflabelright{\five}};
( 0,-4)*{\afacu\three{}{}\four{}{}};
(-4, 0)*{\invisiblemark};
( 4, 0)*{\invisiblemark}}
\quad\to\quad
\atomicflow{
( 0,12)*{\afacu{}{}{}{}\one{}};
( 6,12)*{\afacu{}{}{}{}{}\two};
( 0, 0)*{\afacd{}{}{}{}\three{}};
( 6, 0)*{\afacd{}{}{}{}{}\four};
(-2, 6)*{\afvj4};
( 8, 6)*{\afvj4};
( 3, 6)*{\afex24}}
&\qquad
\vlder{\Phi}{}{\zeta\left\{\vlinf{}{}{\vls(a^\three.a^\four)}{a^\five}\right\}}
              {\xi\left\{\vlinf{}{}{a^\five}{\vls[a^\one.a^\two]}\right\}}
\quad\to_\rcdcu\quad
\vlder{\Phi\{a^\five/\vlsmallbrackets\vlsbr[a^\one.a^\two]\}}{}{\zeta\left\{\box\ContDownContUp\right\}}
                                     {\xi\left\{\vls[a^\one.a^\two]\right\}}
\\
%---------------------------------------
\end{array}
\]
\caption{`Downwards' reduction rules for contraction and their soundness.}
\label{figure:ReductionRulesContraction}
\end{figure}%

%---------------------------------------
\begin{theorem}\label{theorem:ReductionRulesSound}
The reduction rules\/ $\rwdcd$, $\rwdiu$, $\rwdwu $, $\rwdcu$, $\rcdiu$, $\rcdcu$, $\rcuwu$, $\ridwu$, $\rcdwu$ and $\ridcu$ are sound.
\end{theorem}

\begin{proof}
For $r\in\{\rwdcd,\rwdiu,\rwdwu,\rwdcu,\rcdiu,\rcdcu\}$ and $r\colon\phi'\to\psi'$ as in the left columns of Figures~\vref{figure:ReductionRulesWeakening} and \vref{figure:ReductionRulesContraction}, for every $\phi$ and $\psi$ such that $\phi\to_r\psi$ and for every $\Phi$ with flow $\phi$, the right columns of the tables provide reductions $\Phi\to_r\Psi$, where $\Psi$ has flow $\psi$, as follows. If $\Phi'\to_r\Psi'$ is the reduction provided by the table, then
\[
\Phi=
\vlderivation              {
\vlde{\Psi_2}{}{\beta  }  {
\vlde{\Phi' }{}{\beta' } {
\vlde{\Psi_1}{}{\alpha'}{
\vlhy          {\alpha }}}}}
\qquad\hbox{and}\qquad
\Psi=
\vlderivation              {
\vlde{\Psi_2}{}{\beta  }  {
\vlde{\Psi'}{}{\beta' } {
\vlde{\Psi_1}{}{\alpha'}{
\vlhy          {\alpha }}}}}
\quad.
\]
We can deal with the remaining rules by employing dual derivations to the ones shown.
\end{proof}

%---------------------------------------
\begin{remark}\label{remark:ReductionRulesSoundIndependence}
The previous soundness theorem only depends on the switch and medial rules for the reductions in Figure~\vref{figure:ReductionRulesContraction}. Any system obtained from $\SKS$ by replacing $\swi$ and $\med$ with linear rules that can derive them would support a soundness theorem like the one above, for the same reduction rules. For example, we could think of replacing $\swi$ with the rule $\vlinf{\swi'}{}{\vls[(\alpha.\gamma).[\beta.\delta]]}{\vls([\alpha.\beta].[\gamma.\delta])}$, from which $\swi$ is derivable.
\end{remark}

%=======================================
\section{Termination and Confluence}\label{section:TerminationConfluence}

%-----------------------------------------------------------------
\begin{theorem}\label{theorem:RewritingSystemWeakeningTerminating}
Flow rewriting system\/ $\frw$ is terminating.
\end{theorem}

\begin{proof}
At every reduction, the number of edges decreases.
\end{proof}
%----------

%-----------------------------
\begin{remark}\label{RemCycle}
Flow rewriting system $\frc$ is not terminating:
\nopagebreak[4]\medskip\afnegspace
\[
\atomicflow{
( 4  ,8)*{\afaidnw{}{}};
( 6  ,6)*{\afvj4};
( 3  ,0)*{\afaiuex{}{}{}{}{}{}32};
( 0  ,4)*{\afacd{}{}{}{}{}{}};
(-3.5,0)*{\invisiblemark};
( 7.5,0)*{\invisiblemark}}
\quad\to_\frc\quad
\atomicflow{
( 9  ,12)*{\afaidex{}{}{}{}{}{}32};
( 6  , 8)*{\afacu{}{}{}{}{}{}};
(12  , 6)*{\afvj4};
( 0  , 8)*{\afvj8};
( 2  , 2)*{\afaiunw{}{}};
(10  , 2)*{\afaiunw{}{}{}{}{}{}};
(-1.5, 0)*{\invisiblemark};
(13.5, 0)*{\invisiblemark}}
\quad\to_\frc\quad
\atomicflow{
( 6  , 8)*{\afaidnw{}{}};
(14  , 8)*{\afaidnw{}{}};
( 4  , 6)*{\afvj4};
(16  , 6)*{\afvj4};
( 0  , 6)*{\afvj4};
( 2  , 0)*{\afaiu{}{}{}{}{}{}};
(13  , 0)*{\afaiuex{}{}{}{}{}{}32};
(10  , 4)*{\afacd{}{}{}{}{}{}};
(-1.5, 0)*{\invisiblemark};
(17.5, 0)*{\invisiblemark}}
\quad\to_\frc\quad\cdots\quad.
\]
\afnegspace
We see that if a contraction vertex belongs to an $\ai$-cycle, reductions by $\frc$ make it `bounce' in the $\ai$-cycle and create a trail; while bouncing, the vertex alternates between contraction and cocontraction.
\end{remark}
%-----------

%-------------------------------------------------------------------
\begin{theorem}\label{theorem:RewritingSystemContractionTerminating}
Flow rewriting system\/ $\frc$ is terminating on the set of cycle-free atomic flows.
\end{theorem}

\newcommand{\rk}{{\mathsf r}}
\begin{proof}
Let $\phi$ be a cycle-free flow. We associate to each contraction (resp., cocontraction) vertex $\nu$ its \emph{rank} $\rk_\nu=\sum_{p_i\in I_\nu}h_i$, where $I_\nu$ is the set of all maximal $\ai$-paths $p_i=\epsilon^i_1,\dots,\epsilon^i_{h_i}$ from $\nu$, such that $\epsilon^i_1$ is the lower (resp., upper) edge of $\nu$ (so, the rank of a vertex is the sum of the lengths of certain maximal $\ai$-paths from it). Note that every (co)contraction vertex has non-zero rank. We prove that a reduction of $\phi$ by $\frc$ decreases the sum of the ranks of the (co)contraction vertices of $\phi$. First note that the rank of the vertices not involved in the reduction step stays the same (see Remark~\ref{RemRank}). We then need to show that the sum of the ranks decreases for the vertices involved. There are three cases, depending on the reduction rule:
\begin{itemize}
%
\item[$\rcdiu$:]a contraction vertex $\nu$ is replaced by a cocontraction vertex $\nu'$, and $\rk_{\nu'}=\rk_\nu-n$, where $n>0$ is the number of maximal $\ai$-paths from $\nu$ whose first edge is the lower edge of $\nu$;
%
\item[$\ridcu$:]this is dual to the previous case;
%
\item[$\rcdcu$:]a contraction vertex $\nu$ and a cocontraction vertex $\nu'$ are replaced by two contraction vertices $\nu_1$ and $\nu_2$ and two cocontraction vertices $\nu'_1$ and $\nu'_2$; we have $\rk_{\nu_1}+\rk_{\nu_2}=\rk_\nu-n$, where $n>0$ is the number of maximal $\ai$-paths from $\nu$ whose first edge is the lower edge of $\nu$; analogously, we have $\rk_{\nu'_1}+\rk_{\nu'_2}=\rk_{\nu'}-n'$, where $n'>0$ is the number of maximal $\ai$-paths from $\nu'$ whose first edge is the upper edge of $\nu'$.
\end{itemize}
\end{proof}
%----------

%--------------------------------------------------------------------------
\begin{theorem}\label{theorem:RewritingSystemContractionWeakeningConfluent}
Flow rewriting system\/ $\frw\cup\frc$ is confluent.
\end{theorem}

\begin{proof}
It is straightforward to verify the statement by checking each critical pair of $\frw\cup\frc$.
\end{proof}
%----------

%=======================================
\section{Conservation of Paths}\label{section:FlowRewritePathConservation}

\TODO{Show that the number and length of `super paths' are conserved by all reduction rules.}

%========================================
\section{Complexity}\label{section:FlowRewriteComplexity}

%---------------------------------------
\begin{remark}\label{remark:RewriteContractionExponential}
Normalising by $\frc$ can blow the size of atomic flows exponentially, in particular in a situation like the following (noted by Lutz Stra{\ss}burger):
\[
\atomicflow{
(0,29  )*{\afacu{}{}{}{}{}{}};
(0,21  )*{\afacd{}{}{}{}{}{}};
(0,15.8)*{\vdots};
(0, 8  )*{\afacu{}{}{}{}{}{}};
(0, 0  )*{\afacd{}{}{}{}{}{}}}
\quad\to_\frc^\star\quad
\atomicflow{
( 0,29  )*{\afacuexsq{}{}{}{}{}{}21};
(-4,21  )*{\afacunw{}{}{}{}{}{}};
( 4,21  )*{\afacunw{}{}{}{}{}{}};
(-6,17.8)*{\vdots};
(-2,17.8)*{\vdots};
( 2,17.8)*{\vdots};
( 6,17.8)*{\vdots};
( 0, 4  )*{\afacdexsq{}{}{}{}{}{}21};
(-4,10  )*{\afacdnw{}{}{}{}{}{}};
( 4,10  )*{\afacdnw{}{}{}{}{}{}}}
\quad.
\]
In fact, if there are $n$ couples of cocontraction/contraction vertices like the two shown above on the left, then there are $2^n$ maximal $\ai$-paths, and their number (and length) is conserved by $\to_\frc^\star$ (see Remark~\vref{remark:TODO}). Exactly one $\ai$-path passes through each edge in the middle portion of the flow on the right. It follows that normalising derivations by $\frc$ can also blow their size exponentially.
\end{remark}
%-----------

%------------------
\begin{proposition}
Given two derivations $\Phi$ and $\Psi$, such that $\Phi\to_\frw^\star\Psi$, the size of $\Psi$ depends at most linearly on the size of $\Phi$.
\end{proposition}
%----------------

\TODO{Lemma about complexity of weakening reductions.}