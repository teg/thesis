\chapter{Normal Forms}\label{chapter:NormalForms}

In this chapter we see the first use of atomic flows, namely to define normal forms of derivations. Traditionally, in Gentzen-style formalisms, a derivation in normal form is a cut-free derivation. The notion of cut-freeness is a syntactic notion, which does not translate nicely to the more general deep-inference formalisms.

In both Gentzen-style formalisms and deep-inference formalisms, the cut can be considered horizontal composition of two proofs. We make two observations: 1) deep-inference formalisms are symmetric in the vertical axis, whereas Gentzen-style formalisms are not; and 2) in order for the cut to be admissible from deep-inference derivations the symmetry must be broken, to correspond to the asymmetry of Gentzen-style formalisms. In particular, the cut is only admissible from proofs and not derivations.

These observations prompted us to look for a generalisation of cut elimination that work for all deep-inference derivations. Furthermore, since we are in the business of designing bureaucracy free formalisms, we wanted normal forms based on geometric notions which would be as syntax independent as possible.

We defined normal forms based on the causal dependency between structural inference rule instances. Atomic flows contain (by design) exactly the information needed in order to define normal forms in this way.

We call our generalisation of cut elimination \emph{streamlining} and we describe it in terms of atomic flows. Intuitively, if we consider identities and weakenings to be the `creators' of atom occurrences, and cuts and coweakening as the `destroyers' of atom occurrences, then an atomic flow is streamlined if no atom is first created and then destroyed. The shape of a streamlined atomic flow is given in case (\ref{definition:FlowNormalForms:item:Streamlined}) of Definition~\ref{definition:FlowNormalForms}.

The most challenging aspect of streamlining is the elimination of paths from interaction to cut vertices. For this reason, we define the notion of \emph{weakly streamlined} atomic flows, in case (\ref{definition:FlowNormalForms:item:WeaklyStreamlined}) of Definition~\ref{definition:FlowNormalForms}. An atomic flow is weakly streamlined if it contains no paths from interaction to cut vertices. This is the topic of Chapter~\vref{chapter:GlobalReductions}.

A path can be eliminated by removing the edges that make up the path. However, we might imagine a situation where an edge belongs to two paths, one we want to eliminate and one we want to keep. An atomic flow is in \emph{simple form}, if this situation does not occur. One approach to eliminating paths from a flow is to transform it into simple form and then eliminating the edges connecting interaction and cut vertices.

Sometimes, the elimination of edges mapped to by an atom $a$ might interfere with the elimination of edges mapped to from the atom $\bar a$. For this reason, we find it convenient to define special cases of simple form and weakly streamlined, where for every pair of dual atoms the edges mapped to from one of them are ignored. These are cases (\ref{definition:FlowNormalForms:item:SimpleForm}) and (\ref{definition:FlowNormalForms:item:WeaklyStreamlinedPolarity}) of Definition~\ref{definition:FlowNormalForms}.

The intuition behind the other normal forms are:
\begin{itemize}
\item a weakly streamlined flow is streamlined if it contains no paths from interaction (resp., cut) to coweakening (resp., weakening) vertices, or from weakening to coweakening vertices;
\item a streamlined flow is \emph{super streamlined} if it contains no paths from (co)weakening to (co)contraction vertices; and
\item a super streamlined flow is \emph{hyper streamlined} if it contains no path whose first edge is an upper edge of a cocontraction vertex and last edge is the lower edge of a contraction vertex.
\end{itemize}



\TODO{Alessio said: `\emph{I think it's a mistake to consider a derivation weakly streamlined with respect to a polarity. It would be better to say that it is weakly streamlined with the respect to the positive subflow, given a polarity, or something like this.}'}

%---------------------------------------
\begin{definition}\label{definition:FlowNormalForms}
An atomic flow is
\begin{enumerate}
%---
\item\label{definition:FlowNormalForms:item:SimpleForm}
\emph{in simple form with respect to the polarity assignment $\pi$}\index{simple form!flow} if it can be represented as
\[
\atomicflow{
(-20, 14)*{\afvjm4};
(-20,  8)*{\affr68};
(-20, 10)*{\aflabelleft{\ppl}};
%-
(-22,  0)*{\afvjm8};
%-
(-20, -8)*{\affr68};
(-20, -6)*{\aflabelleft{\ppl}};
(-20,-14)*{\afvjm4};
%-
( -3, 16)*{\afaidmex{}{}{}{}{}{}92};
(-12,  8)*{\affr68};
(-12, 10)*{\aflabelleft{\ppl}};
(-15,  0)*{\afcjrm68};
%-
(-15,  0)*{\afcjlm68};
(-12, -8)*{\affr68};
(-12, -6)*{\aflabelleft{\ppl}};
( -3,-16)*{\afaiumex{}{}{}{}{}{}92};
%--
( -1,  8)*{\afaidmex{}{}{}{}{}{}32};
( -4,  0)*{\affr68};
( -4,  2)*{\aflabelleft{\ppl}};
(  6,  8)*{\afvjm8};
( 10, 10)*{\afvjm{12}};
(  6,  0)*{\affr{10}8};
(  4,  2)*{\aflabelleft{\pmi}};
(  6, -8)*{\afvjm8};
( 10,-10)*{\afvjm{12}};
( -1, -8)*{\afaiumex{}{}{}{}{}{}32};
}\qquad
\atomicflow{
( -8, 12.75)*{\afvjm{6.5}};
(  0, 13.5)*{\afawdm{}{}{}{}{}{}};
%---
( -6, 5.5)*{\copy\contrup};
( -4, 5.5)*{\affr{10}8};
( -2, 5.5)*{\copy\contrdown};
%---
( -5,-2.5)*{\afaium{}{}{}{}{}{}};
(  0,   0)*{\afvjm3};
(  5, 2.5)*{\afaidm{}{}{}{}{}{}};
%---
(  2,-5.5)*{\copy\contrup};
(  4,-5.5)*{\affr{10}8};
(  6,-5.5)*{\copy\contrdown};
%---
(  0,-13.5)*{\afawum{}{}{}{}{}{}};
(  8,-12.75)*{\afvjm{6.5}};
}\quad;
\]
%---
\item\label{definition:FlowNormalForms:item:WeaklyStreamlinedPolarity}
\emph{weakly streamlined with respect to the polarity assignment $\pi$}\index{streamlined!weakly!with respect to polarity assignment} if it can be represented as
\[
\atomicflow{
(-20, 14)*{\afvjm4};
(-20,  8)*{\affr68};
(-20, 10)*{\aflabelleft{\ppl}};
%-
(-22,  0)*{\afvjm8};
%-
(-20, -8)*{\affr68};
(-20, -6)*{\aflabelleft{\ppl}};
(-20,-14)*{\afvjm4};
%-
( -9, 16)*{\afaidmex{}{}{}{}{}{}32};
(-12,  8)*{\affr68};
(-12, 10)*{\aflabelleft{\ppl}};
(-15,  0)*{\afcjrm68};
%-
(-15,  0)*{\afcjlm68};
(-12, -8)*{\affr68};
(-12, -6)*{\aflabelleft{\ppl}};
( -9,-16)*{\afaiumex{}{}{}{}{}{}32};
%--
( -6,  8)*{\afvjm8};
(  0, 10)*{\afvjm{12}};
( -3,  0)*{\affr88};
( -4,  2)*{\aflabelleft{\pmi}};
( -6, -8)*{\afvjm8};
(  0,-10)*{\afvjm{12}};
}\qquad
\atomicflow{
( -8, 12.75)*{\afvjm{6.5}};
(  0, 13.5)*{\afawdm{}{}{}{}{}{}};
%---
( -6, 5.5)*{\copy\contrup};
( -4, 5.5)*{\affr{10}8};
( -2, 5.5)*{\copy\contrdown};
%---
( -5,-2.5)*{\afaium{}{}{}{}{}{}};
(  0,   0)*{\afvjm3};
(  5, 2.5)*{\afaidm{}{}{}{}{}{}};
%---
(  2,-5.5)*{\copy\contrup};
(  4,-5.5)*{\affr{10}8};
(  6,-5.5)*{\copy\contrdown};
%---
(  0,-13.5)*{\afawum{}{}{}{}{}{}};
(  8,-12.75)*{\afvjm{6.5}};
}\quad;
\]
%---
\item\label{definition:FlowNormalForms:item:WeaklyStreamlined}
\emph{weakly streamlined}\index{streamlined!weakly} if it can be represented as
\[
\atomicflow{
( -8, 11.5)*{\afvjm4};
(  0, 13.5)*{\afawdm{}{}{}{}{}{}};
%---
( -6, 5.5)*{\copy\contrup};
( -4, 5.5)*{\affr{10}8};
( -2, 5.5)*{\copy\contrdown};
%---
( -5,-2.5)*{\afaium{}{}{}{}{}{}};
(  0,   0)*{\afvjm3};
(  5, 2.5)*{\afaidm{}{}{}{}{}{}};
%---
(  2,-5.5)*{\copy\contrup};
(  4,-5.5)*{\affr{10}8};
(  6,-5.5)*{\copy\contrdown};
%---
(  0,-13.5)*{\afawum{}{}{}{}{}{}};
(  8,-11.5)*{\afvjm4};
}\quad;
\]
%---
\item\label{definition:FlowNormalForms:item:Streamlined}
\emph{streamlined}\index{streamlined} if it can be represented as
\[
\atomicflow{
( -5, 11.5)*{\afvjm4};
%---
(-7.5, 5.5)*{\copy\contrup};
(  -5, 5.5)*{\affr{12}8};
(-2.5, 5.5)*{\copy\contrdown};
%---
(-10,-2.5)*{\afawum{}{}{}{}{}{}};
( -5,-2.5)*{\afaium{}{}{}{}{}{}};
(  0,   0)*{\afvjm3};
(  5, 2.5)*{\afaidm{}{}{}{}{}{}};
( 10, 2.5)*{\afawdm{}{}{}{}{}{}};
%---
(2.5,-5.5)*{\copy\contrup};
(  5,-5.5)*{\affr{12}8};
(7.5,-5.5)*{\copy\contrdown};
%---
(  5,-11.5)*{\afvjm4};
}\quad;
\]
%---
\item\label{definition:FlowNormalForms:item:SuperStreamlined}
\emph{super streamlined}\index{streamlined!super} if it can be represented as
\[
\atomicflow{
(-12,  9.5)*{\afawum{}{}{}{}{}{}};
%---
( -4, 11.5)*{\afvjm4};
%---
( -6, 5.5)*{\copy\contrup};
( -4, 5.5)*{\affr{10}8};
( -2, 5.5)*{\copy\contrdown};
%---
( -5,-2.5)*{\afaium{}{}{}{}{}{}};
(  0,   0)*{\afvjm3};
(  5, 2.5)*{\afaidm{}{}{}{}{}{}};
%---
(  2,-5.5)*{\copy\contrup};
(  4,-5.5)*{\affr{10}8};
(  6,-5.5)*{\copy\contrdown};
%---
(  4,-11.5)*{\afvjm4};
%---
( 12, -9.5)*{\afawdm{}{}{}{}{}{}};
}\quad;\quad\mbox{and}
\]
%---
\item\label{definition:FlowNormalForms:item:HyperStreamlined}
\emph{hyper streamlined}\index{streamlined!hyper} if it can be represented as
\[
\atomicflow{
(-12,  9.5)*{\afawum{}{}{}{}{}{}};
%---
( -4, 11.5)*{\afvjm4};
%---
( -4, 5.5)*{\copy\contrup};
( -4, 5.5)*{\affr{10}8};
%---
( -5,-2.5)*{\afaium{}{}{}{}{}{}};
(  0,   0)*{\afvjm3};
(  5, 2.5)*{\afaidm{}{}{}{}{}{}};
%---
(  4,-5.5)*{\affr{10}8};
(  4,-5.5)*{\copy\contrdown};
%---
(  4,-11.5)*{\afvjm4};
%---
( 12, -9.5)*{\afawdm{}{}{}{}{}{}};
}\quad.
\]
\end{enumerate}
\end{definition}

\begin{definition}\label{definition:DerSimpleForm}
A derivation with associated atomic flow $\phi$ is \emph{in simple form with respect to} (\emph{the atom}) $a$\index{simple form!derivation!with respect to atom}, if $\pi$ is a polarity assignment for $\phi$, such that the edges in $\phi$ mapped to from occurrences of $a$ have a positive polarity, and the restriction of $\phi$ to $a$ is in simple form with respect to $\pi$.
\end{definition}

\begin{definition}\label{definition:DerStreamlined}
A derivation with associated atomic flow $\phi$ is \emph{weakly streamlined} (resp., \emph{streamlined}\index{streamlined!derivation}, \emph{super streamlined} and \emph{hyper streamlined}) if $\phi$ is \emph{weakly streamlined} (resp., \emph{streamlined}, \emph{super streamlined} and \emph{hyper streamlined}). The derivation is \emph{weakly streamlined with respect to} (\emph{the atom}) $a$\index{streamlined!weakly!with respect to atom}, if $\pi$ is a polarity assignment for $\phi$, such that the edges in $\phi$ mapped to from occurrences of $a$ have a positive polarity, and the restriction of $\phi$ to $a$ is weakly streamlined with respect to $\pi$.
\end{definition}

%---------------------------------------
\begin{example}\label{example:Streamlined}
The first flow is weakly streamlined, the other two are hyper streamlined:
\[
\aflower{\atomicflow{
(0,6)*{\afacd{}{}{}{}{}{}};
(4,6)*{\afawd{}{}{}{}};
(2,0)*{\afaiunw{}{}}}}
\quad,\qquad
\atomicflow{
( 2,0)*{\afacd{}{}{}{}{}{}};
( 0,4)*{\afawdnw{}{}};
( 6,8)*{\afacu{}{}{}{}{}{}};
(10,2)*{\afaiunw{}{}{}{}};
(12,8)*{\afvj8}}
\qquad\hbox{and}\qquad
\atomicflow{
(10,8)*{\afacu{}{}{}{}{}{}};
(16,8)*{\afvj8};
( 2,4)*{\afaidnw{}{}};
( 0,0)*{\afvj8};
(14,2)*{\afaiunw{}{}};
( 6,0)*{\afacd{}{}{}{}{}{}}}
\quad.
\]
\end{example}

We now state some facts whose proofs are immediate from Definition~\vref{definition:FlowNormalForms}.

\begin{proposition}\label{proposition:FlowWeaklyStreamlinedPolarity}
Given a polarity assignment $\pi$, an atomic flow that is weakly streamlined with respect to both $\pi$ and $\bar\pi$ is weakly streamlined. 
\end{proposition}

\begin{proposition}\label{proposition:FlowCutFree}
A streamlined atomic flow with no pair of upper (resp., lower) edges such that there is an $\ai$-path between them, contains no cut (resp., axiom) vertices.
\end{proposition}

The following proposition makes the connection between cut elimination and streamlining. We consider the special case of atomic flows of proofs, \emph{i.e.}, atomic flows without upper edges, and observe that a streamlined proof is cut free and a hyper streamlined proof is a proof in system $\KS$.

%---------------------------------------
\begin{proposition}\label{proposition:FlowNormalFormsNoUpper}
Given an atomic flow with no upper (resp., lower) edges, it can be represented as
\begin{enumerate}
\item\label{proposition:FlowNormalFormsNoUpper:item:Streamlined}
\[
\atomicflow{
(  5, 2.5)*{\afaidm{}{}{}{}{}{}};
( 10, 2.5)*{\afawdm{}{}{}{}{}{}};
%---
(4,-5.5)*{\copy\contrup};
(6,-5.5)*{\affr{10}8};
(8,-5.5)*{\copy\contrdown};
%---
(6,-11.5)*{\afvjm4};
(0,-18)*{\invisiblemark};
}
\qquad
\left(\mbox{resp.,}\quad
\atomicflow{
( 0,18)*{\invisiblemark};
(-6,11.5)*{\afvjm4};
%---
(-8, 5.5)*{\copy\contrup};
(-6, 5.5)*{\affr{10}8};
(-4, 5.5)*{\copy\contrdown};
%---
(-10,-2.5)*{\afawum{}{}{}{}{}{}};
( -5,-2.5)*{\afaium{}{}{}{}{}{}};
}
\quad\right)
\quad,
\]
if it is streamlined;
%---
\item\label{proposition:FlowNormalFormsNoUpper:item:SuperStreamlined}
\[
\atomicflow{
(  4, 2.5)*{\afaidm{}{}{}{}{}{}};
%---
(  2,-5.5)*{\copy\contrup};
(  4,-5.5)*{\affr88};
(  6,-5.5)*{\copy\contrdown};
%---
(  4,-11.5)*{\afvjm4};
%---
( 11, -9.5)*{\afawdm{}{}{}{}{}{}};
(0,-18)*{\invisiblemark};
}
\qquad
\left(\mbox{resp.,}\quad
\atomicflow{
( 0,18)*{\invisiblemark};
(-11,  9.5)*{\afawum{}{}{}{}{}{}};
%---
( -4, 11.5)*{\afvjm4};
%---
( -6, 5.5)*{\copy\contrup};
( -4, 5.5)*{\affr88};
( -2, 5.5)*{\copy\contrdown};
%---
( -4,-2.5)*{\afaium{}{}{}{}{}{}};
}
\quad\right)
\quad,
\]
if it is super streamlined; and
%---
\item\label{proposition:FlowNormalFormsNoUpper:item:HyperStreamlined}
\[
\atomicflow{
(  4, 2.5)*{\afaidm{}{}{}{}{}{}};
%---
(  4,-5.5)*{\affr88};
(  4,-5.5)*{\copy\contrdown};
%---
(  4,-11.5)*{\afvjm4};
%---
( 11, -9.5)*{\afawdm{}{}{}{}{}{}};
(0,-18)*{\invisiblemark};
}
\qquad
\left(\mbox{resp.,}\quad
\atomicflow{
( 0,18)*{\invisiblemark};
(-11,  9.5)*{\afawum{}{}{}{}{}{}};
%---
( -4, 11.5)*{\afvjm4};
%---
( -4, 5.5)*{\copy\contrup};
( -4, 5.5)*{\affr88};
%---
( -4,-2.5)*{\afaium{}{}{}{}{}{}};
}
\quad\right)
\quad,
\]
if it is hyper streamlined.
\end{enumerate}
\end{proposition}