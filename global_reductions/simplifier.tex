Consider an atomic flow $\phi'$ with polarity assignemnt $\pi$, such that $\phi$ is the subflow of $\phi'$ containing all the edges with a positive polarity assignment. We can observe that $\phi$ contains four types of paths: 1) paths from $\top$ to $\bot$; 2) paths from an interaction vertex to $\bot$; 3) paths from $\top$ to a cut vertex; and 4) paths from an interaction vertex to a cut vertex. We can turn $\phi'$ into simple form with respect to $\pi$ if we can make sure that no edge belongs to both a path of type 1) and a path of type 4). In the following reduction, we acheive this by making four copies of $\phi$ each of which only contains one of the above types of paths.

%--------------------------------
\newcommand{\frfb}{{\mathsf{sf}}}
\begin{definition}\label{definition:FourBoxes}
We define the reduction $\to_\frfb$ (where $\frfb$ stands for \emph{simple form}\index{simplifier!reduction}) as follows, for any atomic flows $\phi$ and $\psi$ that do not contain any interaction or cut vertices:
\[
\vcenter{\hbox{\includegraphics{Figures/redSimRedex}}}
\quad\to_\frfb\quad
\vcenter{\hbox{\includegraphics{Figures/redSimContractum}}}
\quad.
\]
\end{definition}
%---------------

%------------------------------------------------
\begin{remark}\label{remark:RestrictionFourBoxes}
The reduction $\to_\frfb$ would still be sound if we removed the restriction on the flows $\phi$ and $\psi$ in Definition~\ref{definition:FourBoxes}. However, such a reduction would no longer correspond to the intuition described above.
\end{remark}
%-----------

%--------------------------------------------
\begin{theorem}\label{theorem:SoundFourBoxes}
Reduction\/ $\to_\frfb$ is sound; moreover if $\Phi\to_\frfb\Psi$, then the size of $\Psi$ depends at most polynomially on the size of $\Phi$.
\end{theorem}

\begin{proof}
Let $\Phi$ be a derivation with flow $\phi'$, such that $\phi'\to_\frfb\psi'$. We show that there exists a derivation $\Psi$ with flow $\psi'$ and with the same premiss and conclusion as $\Phi$. In the following, we refer to the figure in Definition~\vref{definition:FourBoxes}.

Assume all the edges in $\phi$ are mapped to from occurrences of the atoms $a_1$, $\dots$, $a_n$, and let
\[
\vlder{\Phi'}{\{\aid,\aiu\}}
{
 \vlsbr[\beta\;.\;\vlinf{}{}{\fff}{\vlsmallbrackets\vls(a_n^\phi.\bar a_n^\psi)}\;.\;\cdots\;.\;\vlinf{}{}{\fff}{\vlsmallbrackets\vls(a_1^\phi.\bar a_1^\psi)}]
}
{
 \vlsbr(\vlinf{}{}{\vlsmallbrackets\vls[a_1^\phi.\bar a_1^\psi]}{\ttt}\;.\;\cdots\;.\;\vlinf{}{}{\vlsmallbrackets\vls[a_n^\phi.\bar a_n^\psi]}{\ttt}\;.\;\alpha)
}\quad,
\]
be the $\ai$-decomposed form of $\Phi$.

\TODO{Consider using $\epsilon$'s instead of $\phi$'s above.}

We show several intermediate derivations which will be used to build $\Psi$. To make it easier to verify the atomic flow of $\Psi$, we will, through a slight misuse of notation, label the atom occurrences of the intermediate derivations to indicate what atomic flow each atom occurrence will map to, once the derivations are combined to create $\Psi$.

Consider the substitution
\[
\sigma=\{a_1^\phi/\vlsmallbrackets\vlsbr([a_1^{f_1(\phi)}.a_1^{f_2(\phi)}].[a_1^{f_3(\phi)}.a_1^{f_4(\phi)}]),\dots,a_n^\phi/\vlsmallbrackets\vlsbr([a_n^{f_1(\phi)}.a_n^{f_2(\phi)}].[a_n^{f_3(\phi)}.a_n^{f_4(\phi)}])\}\;.
\]
We can then obtain, by Proposition~\vref{proposition:DerivationSubstitution}, the derivation $\Phi'\sigma$ with atomic flow
\[
\vcenter{\hbox{\includegraphics{Figures/thmSimplifier1}}}
\qquad.
\]
For every $1\le i\le n$, there exist derivations
\[
\vlinf{}{}
{
 \vls(
  [
   a_i^{f_1(\phi)}
  \;.\;
   \vlinf{}{}{a_i^{f_2(\phi)}}{\fff}
  ]
 \;.\;
  [
   a_i^{f_3(\phi)}
  \;.\;
   \vlinf{}{}{a_i^{f_4(\phi)}}{\fff}
  ]
 )  
}
{a_i}
\qquad\mbox{and}\qquad
\vls
(
 \vlinf{}{}
 {a_i}
 {
  \vlsmallbrackets\vls[a_i^{f_1(\phi)}.a_i^{f_2(\phi)}]
 }
\;.\;
 [
  \vlinf{}{}{\ttt}{a_i^{f_3(\phi)}}
 \;.\;
  \vlinf{}{}{\ttt}{a_i^{f_4(\phi)}}
 ]
)
\quad,
\]

\TODO{`build' is too vague}

which allow us to build
\[
\vlder{\Psi_\top}{}{\alpha\sigma}{\alpha}
\qquad\mbox{and}\qquad
\vlder{\Psi_\bot}{}{\beta}{\beta\sigma}
\quad,
\]
with atomic flows
\[
\vcenter{\hbox{\includegraphics{Figures/thmSimplifier2}}}
\qquad\mbox{and}\qquad
\vcenter{\hbox{\includegraphics{Figures/thmSimplifier3}}}
\qquad,
\]
respectively.
Furthermore, for every $1\le i\le n$, there exist derivations
\[
\Psi_{\ttt,i}\;=\;
\vlderivation
{
 \vlin{=}{}{\vls[([\vlinf{}{}{a_i^{f_1(\phi)}}{\fff}\;.\;a_i^{f_2(\phi)}]\;.\;[\vlinf{}{}{a_i^{f_3(\phi)}}{\fff}\;.\;a_i^{f_4(\phi)}])\;.\;\vlinf{}{}{\bar a_i^{g(\psi)}}{\vls[\bar a_i.\bar a_i]}]}
 {
  \vlin{\swi}{}{\vls[\vlinf{\swi}{}{\vls\vlsmallbrackets[(a_i^{f_2(\phi)}.a_i^{f_4(\phi)}).\bar a_i]}{\vls\vlsmallbrackets(a_i^{f_2(\phi)}.[a_i^{f_4(\phi)}.\bar a_i])}\;.\;\bar a_i]}
  {
   \vlhy{\vls(\vlinf{}{}{\vls[a_i^{f_2(\phi)}.\bar a_i]}{\ttt}\;.\;\vlinf{}{}{\vls[a_i^{f_4(\phi)}.\bar a_i]}{\ttt})}
  }
 }
}
\]
and
\[
\Psi_{\fff,i}\;=\;
\vlderivation
{
 \vlin{\swi}{}{\vls[\vlinf{}{}{\fff}{\vls(a_i^{f_3(\phi)}.\bar a_i)}\;.\;\vlinf{}{}{\fff}{\vls(a_i^{f_4(\phi)}.\bar a_i)}]}
 {
  \vlin{=}{}{\vls(\vlinf{\swi}{}{\vls[a_i^{f_3(\phi)}.(a_i^{f_4(\phi)}.\bar a_i)]}{\vls([a_i^{f_3(\phi)}.a_i^{f_4(\phi)}].\bar a_i)}\;.\;\bar a_i)}
  {
   \vlhy{\vls(([\vlinf{}{}{\ttt}{a_i^{f_1(\phi)}}\;.\;\vlinf{}{}{\ttt}{a_i^{f_2(\phi)}}]\;.\;\vlsmallbrackets[a_i^{f_3(\phi)}.a_i^{f_4(\phi)}])\;.\;\vlinf{}{}{\vls(\bar a_i.\bar a_i)}{\bar a_i^{g(\psi)}})}
  }
 }
}\quad,
\]
which allow us to build
\[
\Psi_\ttt\;=\;
\vlsbr
(
 \vlder{\Psi_{\ttt,1}}{}
 {
  \vlsmallbrackets\vlsbr[a^\phi_1.\bar a^\psi_1]\sigma
 }
 {
  \ttt
 }
\;\;.\;\;\cdots\;\;.\;\;
 \vlder{\Psi_{\ttt,n}}{}
 {
  \vlsmallbrackets\vlsbr[a^\phi_n.\bar a^\psi_n]\sigma
 }
 {
  \ttt
 }
)
\qquad\mbox{and}
\]
\[
\Psi_\fff\;=\;
\vlsbr
[
 \vlder{\Psi_{\fff,n}}{}
 {
  \fff
 }
 {
  \vlsmallbrackets\vlsbr(a^\phi_n.\bar a^\psi_n)\sigma
 }
\;\;.\;\;\cdots\;\;.\;\;
 \vlder{\Psi_{\fff,1}}{}
 {
  \fff
 }
 {
  \vlsmallbrackets\vlsbr(a^\phi_1.\bar a^\psi_1)\sigma
 }
]
\quad,
\]
with atomic flows
\[
\vcenter{\hbox{\includegraphics{Figures/thmSimplifier4}}}
\qquad\mbox{and}\qquad
\vcenter{\hbox{\includegraphics{Figures/thmSimplifier5}}}
\qquad,
\]
respectively.
Combining these derivations we can build
\[
\Psi\;=\;
\vlderivation
{
 \vlde{\vls[\Psi_\bot.\Psi_\fff]}{}
 {
  \beta
 }
 {
  \vlde{\Phi'\sigma}{}
  {
   \vlsbr[\beta.(a^\phi_n.\bar a^\psi_n).\cdots.(a^\phi_1.\bar a^\psi_1)]\sigma
  }
  {
   \vlde{\vls(\Psi_\ttt.\Psi_\top)}{}
   {
    \vlsbr([a^\phi_1.\bar a^\phi_1].\cdots.[a^\phi_n.\bar a^\phi_n].\alpha)\sigma
   }
   {
    \vlhy
    {
     \alpha
    }
   }
  }
 }
}\quad,
\]
with the desired atomic flow.

We know that the size of $\Phi'\sigma$ depends at most polynomially on the size of $\Phi$ by Theorem~\vref{theorem:aiDecomposedForm} and Proposition~\vref{proposition:DerivationSubstitution}, and it is straightforward to observe that the sizes of $\Psi_\ttt$, $\Psi_\top$, $\Psi_\fff$ and $\Psi_\bot$ depend at most linearly on the size of $\Phi$, so the size of $\Psi$ depends at most polynomially on the size of $\Phi$.
\end{proof}
%----------

\TODO{Alessio: I simplified this section to not talk about polarities. Changed definition of operator and proved proposition. Does not affect the following subsections (only the final Main Result section (it makes it much simpler).}

%----------------------------------
\newcommand{\Simpl}{\mathsf{Si}}
\begin{definition}\label{definition:Simplifier}
The \emph{Simplifier}\index{Simplifier}, $\Simpl$, is an operator whose arguments are distinct and pairwise non-dual atoms $a_1$, $\dots$, $a_n$ and a derivation $\Phi$, with atomic flow
\[
\vcenter{\hbox{\includegraphics{Figures/defSimplifier}}}
\quad,
\]
such that all the edges in $\phi$ are mapped to from occurrences of $a_1$, $\dots$, $a_n$ and no edges in $\psi$ are mapped to from occurrences of $a_1$, $\dots$, $a_n$.
We then define $\Simpl(\Phi,a_1,\dots,a_n)$ to be such that $\Phi\to_\frfb\Simpl(\Phi,a_1,\dots,a_n)$, where $\phi$ and $\psi$ are the flows, by the same names, shown in Definition~\vref{definition:FourBoxes}.
\end{definition}
%---------------

%------------------------------------------------------------
\begin{proposition}\label{proposition:Simplifier}
Given distinct and pairwise non-dual atoms $a_1$, $\dots$, $a_n$, and a derivation $\Phi$,
\begin{enumerate}
\item $\Simpl(\Phi,a_1,\dots,a_n)$ is in simple form with respect to $a_1$, $\dots$, $a_n$;
\item for any atom $b$, if\/ $\Phi$ is weakly streamlined with respect to $b$, then\/ $\Simpl(\Phi,a_1,\dots,a_n)$ is weakly streamlined with respect to $b$; and
\item the size of\/ $\Simpl(\Phi,a_1,\dots,a_n)$ depends at most polynomially on the size of\/ $\Phi$.
\end{enumerate}
\end{proposition}

\begin{proof}
In the following we refer to the figure in Definition~\vref{definition:FourBoxes}:
\begin{itemize}
\item by case (\ref{definition:FlowNormalForms:item:SimpleForm}) of Definition~\vref{definition:FlowNormalForms};
\item by studying the atomic flows in Definition~\ref{definition:FourBoxes} we can observe that for every path from an interaction vertex to a cut vertex in the atomic flow of $\Simpl(\Phi,a_1,\dots,a_n)$ whose edges are mapped to from occurrences of $b$, there is a path from an interaction vertex to a cut vertex in the atomic flow of $\Phi$ whose edges are mapped to from occurrences of $b$; and
\item by Theorem~\vref{theorem:SoundFourBoxes}.
\end{itemize}
\end{proof}
%----------